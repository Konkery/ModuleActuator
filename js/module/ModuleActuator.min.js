class ClassAncestorActuator{constructor(_actuatorProps,_opts){_opts.pins&&_opts.pins.forEach(pin=>{if(!+Pin(pin))throw new Error("Not a pin")}),_opts.bus&&(this._Bus=_opts.bus),_opts.pins&&(this._Pins=_opts.pins),this.InitProps(_actuatorProps)}InitProps(_actuatorProps){const changeNotation=str=>`_${str[0].toUpperCase()}${str.substr(1)}`;if("number"!=typeof _actuatorProps.quantityChannel||_actuatorProps.quantityChannel<1)throw new Error("Invalid QuantityChannel arg ");this._QuantityChannel=_actuatorProps.quantityChannel,["name","type","typeInSignal","typeOutSignal","channelNames","busTypes"].forEach(prop=>{if(_actuatorProps[prop]instanceof Array)_actuatorProps[prop].forEach(elem=>{if("string"!=typeof elem)throw new Error("Incorrect sensor property")});else if("string"!=typeof _actuatorProps[prop])throw new Error("Incorrect sensor property");this[changeNotation(prop)]=_actuatorProps[prop]}),this._ManufacturingData=_actuatorProps.manufacturingData||{}}}class ClassMiddleActuator extends ClassAncestorActuator{constructor(_actuatorProps,_opts){ClassAncestorActuator.apply(this,[_actuatorProps,_opts]),this._Values=[],this._Channels=[],this._IsChUsed=[],this.InitChannels()}get CountChannels(){return this._Channels.filter(o=>o instanceof ClassChannelActuator).length}GetChannel(_num){const num=_num;return this._Channels[num]instanceof ClassChannelActuator?this._Channels[num]:null}InitChannels(){for(let i=0;i<this._QuantityChannel;i++)try{this._Channels[i]=new ClassChannelActuator(this,i)}catch(e){this._Channels[i]=null}this._IsChUsed[i]=!1}Init(_opts){}Start(_ch_num,_arg,_opts){}Stop(_ch_num){}ChangeFreq(_freq){}ConfigureRegs(_opts){}Reset(){}Run(_ch_num,_arg,_opts){}Read(_reg){}Write(_reg,_val){}}class ClassChannelActuator{constructor(actuator,num){if(actuator._Channels[num]instanceof ClassChannelActuator)return actuator._Channels[num];this._ThisActuator=actuator,this._NumChannel=num,this._DataRefine=new ClassDataRefine,this._Alarms=new ClassAlarms,actuator._Channels[num]=this}get ID(){return this._ThisActuator._Name+this._NumChannel}get IsUsed(){return this._ThisActuator._IsChUsed[this._NumChannel]}Start(_arg,_opts){let arg=this._DataRefine.TransformValue(_arg);return arg=this._DataRefine.SuppressValue(arg),this._Channels[_ch_num]._Alarms.CheckZone(arg),this._ThisActuator.Start(this._NumChannel,arg,_opts)}Stop(){return this._ThisActuator.Stop(this._NumChannel)}ChangeFreq(_freq){return this._ThisActuator.ChangeFreq.call(this._ThisActuator,Array.from(arguments))}Reset(){return this._ThisActuator.Reset.apply(this._ThisActuator,Array.from(arguments))}Run(_opts){const args=Array.from(arguments);return args.unshift(this._NumChannel),this._ThisActuator.Run.apply(this._ThisActuator,args)}ConfigureRegs(_opts){return this._ThisActuator.ConfigureRegs.apply(this._ThisActuator,Array.from(arguments))}}class ClassDataRefine{constructor(){this._Values=[],this.SetLim(-1/0,1/0),this.SetTransformFunc(1,0)}SetLim(_limLow,_limHigh){if("number"!=typeof _limLow||"number"!=typeof _limHigh)throw new Error("Not a number");if(_limLow>=_limHigh)throw new Error("limLow value shoud be less than limHigh");return this._Values[0]=_limLow,this._Values[1]=_limHigh,!0}SuppressValue(val){return E.clip(val,this._Values[0],this._Values[1])}SetTransformFunc(_k,_b){if("number"!=typeof _k||"number"!=typeof _b)throw new Error("Not a number");return this._Values[2]=_k,this._Values[3]=_b,!0}TransformValue(val){return val*this._Values[2]+this._Values[3]}}const indexes={redLow:0,yelLow:1,green:2,yelHigh:3,redHigh:4};class ClassAlarms{constructor(){this._Zones=[],this._Callbacks=[],this._CurrZone="green"}SetZones(opts){const checkParams={green:()=>"function"==typeof opts.green.cb,yellow:()=>opts.yellow.low<opts.yellow.high,red:()=>opts.red.low<opts.red.high};if(["red","yellow","green"].filter(zoneName=>opts[zoneName]).forEach(zoneName=>{if(!checkParams[zoneName])throw new Error("Incorrect args")}),opts.yellow){if(opts.red){if(opts.yellow.low<=opts.red.low||opts.yellow.high>=opts.red.high)throw new Error("Invalid args")}else if(opts.yellow.low<this._Zones[indexes.redLow]||opts.yellow.high>this._Zones[indexes.redHigh])throw new Error("Invalid args");this._Zones[indexes.yelLow]=opts.yellow.low,this._Zones[indexes.yelHigh]=opts.yellow.high,this._Callbacks[indexes.yelLow]=opts.yellow.cbLow,this._Callbacks[indexes.yelHigh]=opts.yellow.cbHigh}if(opts.red){if(opts.yellow){if(opts.red.low>=opts.yellow.low||opts.red.high<=opts.yellow.high)throw new Error("Invalid args")}else if(opts.red.low>this._Zones[indexes.yelLow]||opts.red.high<this._Zones[indexes.yelHigh])throw new Error("Invalid args");this._Zones[indexes.redLow]=opts.red.low,this._Zones[indexes.redHigh]=opts.red.high,this._Callbacks[indexes.redLow]=opts.red.cbLow,this._Callbacks[indexes.redHigh]=opts.red.cbHigh}opts.green&&(this._Callbacks[indexes.green]=opts.green.cb)}CheckZone(val){let prevZone=this._CurrZone;this._CurrZone=val<this._Zones[indexes.redLow]?"redLow":val>this._Zones[indexes.redHigh]?"redHigh":val<this._Zones[indexes.yelLow]?"yelLow":val>this._Zones[indexes.yelHigh]?"yelHigh":"green",prevZone!==this._CurrZone&&this._Callbacks[indexes[this._CurrZone]](prevZone)}}exports=ClassMiddleActuator;